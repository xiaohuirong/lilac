_model='medium.en'
_model_sha1sum='8c30f0e44ce9560643ebd10bbe50cd20eafd3723'
_pkgbase='whisper.cpp-model'
# Maintainer: Hauke Rehfeld <aur@haukerehfeld.de>
pkgname="${_pkgbase}-${_model}"
pkgver=1
pkgrel=3
pkgdesc="This is an autogenerated file, please see https://github.com/hrehfeld/archlinux-whisper.cpp-model"
arch=("i686" "x86_64")
url="https://github.com/ggerganov/whisper.cpp/tree/master/models"
license=("MIT")

makedepends=()
depends=()
conflicts=()
provides=()

_model_file="ggml-${_model}.bin"
_model_path="/usr/share/$pkgname/${_model_file}"

_download_script_name="download-ggml-model.sh"
_download_script_url="https://github.com/ggerganov/whisper.cpp/raw/master/models/download-ggml-model.sh"

source=("$_download_script_url")
sha1sums=('2446b8d3ed58e79ebdd6a0272392314791fa5a3c')

prepare() {
    chmod +x $_download_script_name
    ./$_download_script_name "$_model" "."
}

package() {
  install -Dm644 "${srcdir}/${_model_file}" "$pkgdir$_model_path"

  wrapper="whisper.cpp-${_model}"
  echo "#!/bin/sh
/usr/bin/whisper.cpp --model ${_model_path} "\"'$@'\" > "$srcdir/$wrapper"
  install -Dm755 "${srcdir}/$wrapper" "$pkgdir/usr/bin/$wrapper"


}
